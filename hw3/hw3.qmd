---
title: "HW3: How does climate hazard risk exposure vary across racial / ethnic groups in California?"
format: html
author: Sofia Rodas
Date: February 12, 2026
warning: false
message: false
---

# How does climate hazard risk exposure vary across racial/ethnic groups in California?

This quarto document explores how FEMA National Risk Index (NRI) (2023) scores throughout California vary between racial and ethnic groups. Ethnicity data is downloaded directly from the American Community Survey (ACS) Census data for 2023.

```{r}
#|warning: false
#|message: false

# load in necessary libraries
library(tidyverse)
library(tidycensus)
library(janitor)
library(patchwork)
```

## Load data

The code commented out below allows us to directly download ACS census data into R. It is commented out as it was saved as a csv and is now accessed locally.

```{r}
# #....Step 1a: see all available ACS variables + descriptions.....
# acs_vars <- tidycensus::load_variables(year = 2023,
#                                        dataset = "acs1")
# 
# #..............Step 1b: import race & ethnicity data.............
# race_ethnicity <- tidycensus::get_acs(
#   geography = "county",
#   survey = "acs1",
#   # NOTE: you may not end up using all these variables
#   variables = c("B01003_001", "B02001_002", "B02001_003", 
#                 "B02001_004", "B02001_005", "B02001_006",
#                 "B02001_007", "B02001_008", "B03002_012",
#                 "B03002_002"),
#   state = "CA", 
#   year = 2023) |>
#   # join variable descriptions (so we know what's what!)
#   dplyr::left_join(acs_vars, by = dplyr::join_by(variable == name)) 
# 
# #.................Step 2: write ACS data to file.................
# readr::write_csv(race_ethnicity, here::here("data", "ACS-1yr-2023-county-race-ethnicity.csv"))

#..................Step 3: read in your CSV file.................
race_ethnicity <- readr::read_csv(here::here("data", "ACS-1yr-2023-county-race-ethnicity.csv"))
```

```{r}
# load in the NRI data
nri <- read_csv(here::here("data", "National_Risk_Index_Counties.csv")) |> 
  clean_names()
```

## Clean data

The ACS data is not "tidy-data". Lets make some changes to tidy the data. 

Change the data frame from long to wide so that every row is an observation. This step also drops rows that will not be analyzed in this visualization.
```{r}
race_ethnicity <- race_ethnicity |>  
  pivot_wider(names_from = label, values_from = c(estimate)) |> 
  clean_names() |> 
  select(!c(moe, variable, concept, estimate_total_not_hispanic_or_latino)) # drop unnecessary columns
  
```

The data frame is still not tidy because each county name has a row for each column. Let's make one row for each county instead.

```{r}
race_ethnicity <- race_ethnicity |> 
  group_by(name) |> 
  summarise(across(starts_with("estimate_total"), ~sum(., na.rm = T))) |> 
  ungroup()
```

The ethnicity data needs to be combined with the NRI data so let's make the county column uniform with the county column in the NRI data to join the data frames by.
```{r}
race_ethnicity <- race_ethnicity |> 
  mutate(county_name = str_remove_all(name, " County, California")) |> 
  select(!c(name)) |> 
  relocate(county_name, .before = estimate_total) # move the name column to the front of the df
```

The NRI data includes data for all of the United States. This analysis focuses on California alone. Filter the NRI data to only CA data.
```{r}
nri <- nri |> 
  filter(state_name == "California")
```

Join the NRI data and ethnicity data for the rest of the analysis.

```{r}
ethnicity_nri <- full_join(race_ethnicity, nri, by = join_by(county_name))
```

The column names are not intuitive so let's change the column names.
```{r}
ethnicity_nri <- ethnicity_nri |> 
  rename(total_pop = estimate_total,
         white_pop = estimate_total_white_alone,
         black_pop = estimate_total_black_or_african_american_alone,
         indigenous_pop = estimate_total_american_indian_and_alaska_native_alone,
         asian_pop = estimate_total_asian_alone,
         paci_islander_pop = estimate_total_native_hawaiian_and_other_pacific_islander_alone,
         other_race = estimate_total_some_other_race_alone,
         two_races = estimate_total_two_or_more_races,
         latino_pop = estimate_total_hispanic_or_latino)
```

# Stacked Barplot by county filled with breakup of ethnicity
To make a stacked barplot the data must be in long format so all the values are in one column corresponding to one column with the variable it defines. Make the long data frame so that the population variable names are in one column and the corresponding values are in another column. 

```{r}
bp_ethnicity_nri <- ethnicity_nri |>  
  select(county_name, 
         white_pop,
         black_pop,
         indigenous_pop,
         asian_pop,
         paci_islander_pop,
         other_race,
         two_races,
         latino_pop) |> 
  pivot_longer(cols = -county_name,
               names_to = "variable",
               values_to = "values")
```

The NRI values are lost in this process so let's join the NRI data back and keep only the variable we are interested in `national_risk_index_rating_composite`.
```{r}
bp_ethnicity_nri <- left_join(bp_ethnicity_nri, nri, by = join_by(county_name))

bp_ethnicity_nri <- bp_ethnicity_nri |> 
   select(county_name, 
         variable,
         values,
         national_risk_index_rating_composite) |> 
  drop_na()

```

Let's define a color palette in advance for all of the ethnicities so they are easier to call when creating the stacked bar plots. 
```{r}
asian <- "#560bad"
black <- "#8BC34A"
indigenous <- "#AD1457"
white <- "#F44336"
latino <- "#009688"
other <- "#F9C74F"
two <- "#FF9800"
pacif_islander <- "#1565C0"

```

California counties all have an NRI score that is in the categories of "Very High", "Relatively High", "Relatively Moderate", or "Relatively Low". A stacked bar plot for each of these categories will show the break down of the race and ethnicity data for each county based on it's NRI score. For better control on the numerous aspects of the graph each NRI category graph is made individually and then added into one visual via `patchwork`. 

### NRI score "Very High" Bar Plot
```{r}
very_high <- bp_ethnicity_nri |> 
  filter(national_risk_index_rating_composite == "Very High") |> 
ggplot(aes(fill= variable , y=values, x=county_name)) + 
    geom_bar(position="fill", stat="identity") +
  coord_flip() +
  theme_minimal() + 
  scale_fill_manual(values = c(asian,
                                 black, 
                                 indigenous,
                                 latino, 
                                 other,
                                 pacif_islander,
                                 two, 
                                 white),
                     labels = c("Asian",
                               "Black", 
                               "Indigenous",
                               "Latino", 
                               "Other", 
                               "Pacific Islander",
                               "Two or More Races", 
                               "White")) +
  labs(fill = "Ethnicity Population",
       y = "Percentage",
        title = "Very High NRI Risk") +
  theme(axis.title.y = element_blank())
```
### NRI score "Relatively High" Bar Plot
```{r}
relatively_high <- bp_ethnicity_nri |> 
  filter(national_risk_index_rating_composite == "Relatively High") |> 
ggplot(aes(fill= variable , y=values, x=county_name)) + 
    geom_bar(position="fill", stat="identity") +
  coord_flip() +
  theme_minimal() + 
  scale_fill_manual(values = c(asian,
                                 black, 
                                 indigenous,
                                 latino, 
                                 other,
                                 pacif_islander,
                                 two, 
                                 white),
                     labels = c("Asian",
                               "Black", 
                               "Indigenous",
                               "Latino", 
                               "Other", 
                               "Pacific Islander",
                               "Two or More Races", 
                               "White")) +
  labs(fill = "Ethnicity Population",
       y = "Percentage",
        title = "Relatively High NRI Risk") +
  theme(axis.title.y = element_blank())
```
### NRI score "Relatively Moderate" Bar Plot
```{r}
relatively_moderate <- bp_ethnicity_nri |> 
  filter(national_risk_index_rating_composite == "Relatively Moderate") |> 
ggplot(aes(fill= variable , y=values, x=county_name)) + 
    geom_bar(position="fill", stat="identity") +
  coord_flip() +
  theme_minimal() + 
  scale_fill_manual(values = c(asian,
                                 black, 
                                 indigenous,
                                 latino, 
                                 other,
                                 pacif_islander,
                                 two, 
                                 white),
                    labels = c("Asian",
                               "Black", 
                               "Indigenous",
                               "Latino", 
                               "Other", 
                               "Pacific Islander",
                               "Two or More Races", 
                               "White")) +
  labs(fill = "Ethnicity Population",
       y = "Percentage",
        title = "Relatively Moderate NRI Risk") +
  theme(axis.title.y = element_blank())
```
### NRI score "Relatively Low" Bar Plot
```{r}
relatively_low <- bp_ethnicity_nri |> 
  filter(national_risk_index_rating_composite == "Relatively Low") |> 
ggplot(aes(fill= variable , y=values, x=county_name)) + 
    geom_bar(position="fill", stat="identity") +
  coord_flip() +
  theme_minimal() + 
  scale_fill_manual(values = c(asian,
                                 black, 
                                 indigenous,
                                 latino, 
                                 other,
                                 pacif_islander,
                                 two, 
                                 white),
                     labels = c("Asian",
                               "Black", 
                               "Indigenous",
                               "Latino", 
                               "Other", 
                               "Pacific Islander",
                               "Two or More Races", 
                               "White")) +
  labs(fill = "Ethnicity Population",
       y = "Percentage",
        title = "Relatively Low NRI Risk") +
  theme(axis.title.y = element_blank())
```
### Final Stacked Bar Plot
```{r}
#| fig-alt: There are four stacked bar plots showing the ethnic break down of the populations of California counties. Each stacked bar plot is all of the counties in each NRI category represented in California, either "Very High", "Relatively High", "Relatively Moderate", or "Relatively Low". None of the counties in the "Very High" category have a white population above 40% while both the "Relatively High" and "Relatively Moderate" categories have some counties with above 50% white populations. There is only one county California in the "Relatively Low" NRI category" 
#| fig-cap: Data- FEMA National Risk Index (2023 Release) and American Community Survey (ACS) Census data (2023)


very_high +  relatively_high  + relatively_moderate + relatively_low +
  plot_annotation(title = "NRI and Ethnicity Scores for Counties in California",
                  subtitle = "Counties with NRI scores in the Relatively High and Relatively Moderate categories have a higher percent white population than counties in the Very High category",
                  theme = theme(plot.title = element_text(size = 24, face = "bold"))) + 
  plot_layout(guides = "collect",
              axis_titles = "collect")


```
**1. What are your variables of interest and what kinds of data (e.g. numeric, categorical, ordered, etc.) are they (a bullet point list is fine)?**

- NRI category rating: categorical  
- Population data by ethnicity: numeric  
- Counties in CA: categorical  

**2. How did you decide which type of graphic form was best suited for answering the question? What alternative graphic forms could you have used instead? Why did you settle on this particular graphic form?**  
I made some exploratory graphs that were horrific. I initially made a heat map but it was difficult to get all three variables of interest listed above into the graph. I used the website from data to viz to decide what plots to explore. Their tree of attributes to decide what type of visual to use for what attributes the data has is super helpful. I could have made sankey diagram to visualize this data as well. 

**3. Summarize your main finding in no more than two sentences.**  
All of the counties in the Very High NRI category are less than 40% white; this is in contrast to the counties that are in the Relatively High and Relatively Moderate NRI category where there are a greater number of counties that are over 50% white.  

**4. What modifications did you make to this visualization to make it more easily readable?**  
I made the barplots horizontal instead of vertical for easier visualization of the breakdown of the ethnicity population in each county. The horizontal bar plots is also helpful for making the county names easily readable. I additionally chose a color scheme that is color blind friendly. 

**5. Is there anything you wanted to implement, but didnâ€™t know how? If so, please describe.**  
I implemented everything I wanted to implement in this visual. 
