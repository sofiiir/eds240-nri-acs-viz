---
title: "hw2_hexplot"
format: html
author: Sofia Rodas
Date: January 28, 2026
warning: false
message: false 
---

This quarto document explores FEMA National Risk Index scores throughout California in comparison to the NRI scores in other states. 

How do FEMA National Risk Index scores for counties in California compare to those in other states? 

```{r}
# load necessary libraries
library(tidyverse)
library(janitor)
library(sf)
```

```{r}
# read in data
nri <- read_csv(here::here("data", "National_Risk_Index_Counties.csv"))

# clean names
nri <- clean_names(nri)
```

Check the number of states. This analysis will only include the 50 US states. 
```{r}
# number of states included
length(unique(nri$state_name))
```

Filter to only the 50 states. 
```{r}
# only select for 50 states
nri <- nri |> 
  filter(nri$state_name %in% state.name)
```

Let's explore another map. The Hexbin map will have a better layout and will ensure the information on the East Coast is visible in comparison to the bubble map. The hexagons were downloaded from https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map. 
```{r}
hexagons <- read_sf("data/us_states_hexgrid.geojson")
```

How do FEMA National Risk Index scores for counties in California compare to those in other states? My interpretation of this question is to average out all of the NRI scores for each state. 
```{r}
nri_high_risk <- nri |> 
  group_by(state_name_abbreviation) |> 
  summarize(high_risk_count = sum(national_risk_index_rating_composite == "Relatively High", 
                                  na.rm = TRUE)) |> 
  rename(state_abbr = state_name_abbreviation) |> 
  ungroup()
```

The column names need to be cleaned.
```{r}
hexagons <- hexagons |> 
  rename(state_abbr = iso3166_2) |> 
   mutate(google_name = gsub(" \\(United States\\)", "", google_name))
  
```

Join the two dataframes for plotting.
```{r}
hex_nri <- left_join(nri_high_risk, hexagons, by = join_by(state_abbr))
```

Calculate the minimum and maximum in the values of states with the most "Relatively High" counties.
```{r}
min(hex_nri$high_risk_count)
max(hex_nri$high_risk_count)
```


Create bins to include the minimum and maximum NRI values. 
```{r}
hex_nri$bin <- cut(hex_nri$high_risk_count,
  breaks = c(-0.1, 0, 2, 5, 15, 22),
  labels = c("Zero counties", "1-2 Counties", "2-5 Counties", "5-15 Counties", "15-22 Counties"),
  include.lowest = TRUE
)
```


Plot the hexbins with national risk index state percentile composite.
```{r}
#| fig-cap: Data - FEMA National Risk Index (2025 Release)
 
ggplot(hex_nri) + 
  geom_sf(aes(geometry = geometry, fill = bin)) + 
  geom_sf_text(aes(geometry = geometry, label = state_abbr), 
               color = "black", 
               size = 3, 
               alpha = 0.6) +
  theme_void() +
  scale_fill_manual(name = "",
    values = c("#FEF1EC",
               "#FABB9E",
               "#F5773D",
               "#C2440A",
               "#612205")) +
#  guides(fill = guide_coloursteps((title.position = "top"))) +
  labs(title = "Number of Counties with Relatively High National Risk Index Scores") +
  theme(plot.title = element_text(hjust = 0.5),
    legend.position = "bottom")
  
```

1. What are your variables of interest and what kinds of data (e.g. numeric, categorical, ordered, etc.) are they (a bullet point list is fine)?
- Variable of interest: Number of counties that have "Relatively High" NRI scores per state.

2. How did you decide which type of graphic form was best suited for answering the question? What alternative graphic forms could you have used instead? Why did you settle on this particular graphic form?
- Since this data is highly geographic some form of spatial data felt best to visualize the states with the highest count of counties with NRI scores in the "Relatively High" category. Originally, I made a bubble map but the east coast has too many and too close of states to make it effective. This hexbins map assigns one value to each hexagon and maintains the size regardless of the true states size acting as a proxy for actually mapping the data.

3. Summarize your main finding in no more than two sentences.
- California and Florida are the two states that have the most number of counties with NRI scores in the "Relatively High" risk categories.

4. What modifications did you make to this visualization to make it more easily readable?
- I moved the legend to the bottom of the graph so that the map can span the length of the plot.
- I customized the colors to make them monochromatic displaying the values from low to high.
- I changed the labels in the legend and removed the title since it was redundant with the title of the graph.
- I added labels to the hexagons so that it is easy to interpret and understand.

5. Is there anything you wanted to implement, but didnâ€™t know how? If so, please describe. 
- I wanted to change the color of the labels for California and Florida to white so that it could be easier to see. I had trouble implementing the change for just some of the labels of the hexagons.
- I also wanted to move the labels to the top of the graph but the spacing was crammed and I was unsure how to adjust the overall spacing. 